#include "GameAlgorithm.h"
#include "GameBase.h"
const bool GameBase::MAP_ARR[static_cast<uint8_t>(eMapSize::Y)][static_cast<uint8_t>(eMapSize::X)] =
{
{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
};
/////////////////////////////////////////////////////////////////////////////////////////////////
// Public Method
void GameBase::SetConsoleAttribute(void)
{
	std::string title = "Snake Game";
	setConsoleSize(static_cast<uint8_t>(eMapSize::X) * 2, static_cast<uint8_t>(eMapSize::Y) + 1);
	setConsoleTitle(title);
	removeConsoleCursor();
}
void GameBase::DrawMap(void)
{
	system("cls");
	for (int32_t iMapY = 0; iMapY < static_cast<uint8_t>(eMapSize::Y); iMapY++)
	{
		for (int32_t iMapX = 0; iMapX < static_cast<uint8_t>(eMapSize::X); iMapX++)
		{
			if (MAP_ARR[iMapY][iMapX] == true)
			{
				std::cout << "бс";
			}
			else
			{
				std::cout << " ";
			}
		}
		std::cout << std::endl;
	}
	MoveConsoleCursor((static_cast<uint8_t>(eMapSize::X) / 2) - 5, (static_cast<uint8_t>(eMapSize::Y) / 2) - 2);
	std::cout << "Game Start: SPACE BAR";
	MoveConsoleCursor((static_cast<uint8_t>(eMapSize::X) / 2) - 5, (static_cast<uint8_t>(eMapSize::Y) / 2) - 1);
	std::cout << "Game Exit: ESC";
}
bool GameBase::StartGame(void)
{
	GameAlgorithm gameAlgorithm;
	return gameAlgorithm.StartGame();
}
void GameBase::ShowGameResult(const bool bGameClear)
{
	uint8_t key;
	MoveConsoleCursor((static_cast<uint8_t>(eMapSize::X) / 2) - 5, (static_cast<uint8_t>(eMapSize::Y) / 2) - 2);
	if (bGameClear == true)
	{
		std::cout << "GAME CLEAR!!!";
	}
	else
	{
		std::cout << "GAME OVER...";
	}
	MoveConsoleCursor((static_cast<uint8_t>(eMapSize::X) / 2) - 5, (static_cast<uint8_t>(eMapSize::Y) / 2) - 1);
	std::cout << "Press Any Key...";
	key = _getch();
	switch (key)
	{
	case static_cast<uint8_t>(eAsciiKey::EXTENDED_0x00): // intentional fall through
	case static_cast<uint8_t>(eAsciiKey::EXTENDED_0xE0):
		key = _getch();
		break;
	default:
		break;
	}
}
void GameBase::MoveConsoleCursor(const uint32_t x, const uint32_t y)
{
	COORD cursorPos;
	cursorPos.X = x * 2;
	cursorPos.Y = y;
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), cursorPos);
}
const bool(*GameBase::GetMap(void))[static_cast<uint8_t>(eMapSize::X)]
{
return MAP_ARR;
}
/////////////////////////////////////////////////////////////////////////////////////////////////
// Private Method
void GameBase::setConsoleSize(const int32_t cols, const int32_t lines)
{
	std::string consoleSize = "mode con: cols=" + std::to_string(cols) + " lines=" + std::to_string(lines);
	system(consoleSize.c_str());
}
void GameBase::setConsoleTitle(const std::string& title)
{
	std::string gameTitle = "title " + title;
	system(gameTitle.c_str());
}
void GameBase::removeConsoleCursor(void)
{
	CONSOLE_CURSOR_INFO cursorInfo;
	cursorInfo.bVisible = 0;
	cursorInfo.dwSize = 1;
	SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &cursorInfo);
}
